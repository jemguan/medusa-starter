import{u as q,a as M,b as H}from"./chunk-ZJRFL6ZN-CohUKNYw.js";import{u as Q,a as $,b as Z}from"./chunk-EL4SSAMX-Bg5QSTBS.js";import{ba as R,j as e,R as J,d as K,a as U,dS as X,q as Y,b as h,u as W,e5 as V,H as w,A as T,T as u,r as _,dZ as ee,k as G,e6 as se,bx as i,L as te,B as re,aR as ae,p as oe,s as ie,t as f,e7 as ne}from"./index-DBWnS55e.js";import{u as N,_ as O}from"./chunk-GIYLQ7GZ-Dxzza7Al.js";import"./lodash-CkfAw9Ei.js";import"./chunk-RGGFF4GO-BDh_Ux-6.js";import"./chunk-BNLHRJ2A-B4VOBEOm.js";import"./chunk-KHOKHZC6-CqxQBDX6.js";import{S as ce}from"./chunk-2RQLKDBF-Bh7PNNZz.js";import{P as z}from"./pencil-square-BGxxvtjf.js";import{T as I}from"./trash-BbCe7kO5.js";import{A as le}from"./arrow-path-CaEWk3Vo.js";import{u as k}from"./use-prompt-QBO7IBKf.js";import{C as A}from"./container-5t1z13_s.js";import{S as me}from"./status-badge-BYt30wMY.js";import{C as E}from"./checkbox-Dx5Ec5yQ.js";import{c as B}from"./index-C6aG_rAm.js";import"./chunk-C76H5USB-BMI9TpQ9.js";import"./chunk-MSDRGCRR-D20aVZP0.js";import"./chunk-P3UUX2T6-OnzgsjCG.js";import"./chunk-B4FQDBC3-9hEpq7g-.js";import"./format-DNy3JvIM.js";import"./chunk-LHJ6JQGA-C8EHrJT1.js";import"./chunk-FSMQADBD-Dkr3W4bN.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./chunk-MUXBF6QF-CTl6bsBs.js";import"./chunk-ADOCJB6L-BybeEzAu.js";import"./react-country-flag.esm-DtVBKmop.js";import"./chunk-YEDAFXMB-B4PnkAmC.js";import"./chunk-AOFGTNG6-Bq5N9j8X.js";import"./table-Cm0Q73Cc.js";import"./chunk-WX2SMNCD-BhhDqt1V.js";import"./plus-mini-BWMzFMSU.js";import"./command-bar-BfvDtHkO.js";import"./index-Doo_3Q1b.js";import"./chunk-EPATMX2O-BgfuWjsz.js";import"./_isIndex-DEiN0s9l.js";import"./x-mark-mini-6vGwjIi3.js";import"./date-picker-kwlXJTN2.js";import"./clsx-B-dksMZM.js";import"./popover-DBRdYr3T.js";import"./triangle-left-mini-4LlIioCu.js";import"./Trans-B06GFbPO.js";import"./check-BVlAH3XP.js";import"./prompt-BFR56MoQ.js";var gs=s=>{const{id:t}=s.params||{},{customer:r}=R(t,void 0,{initialData:s.data,enabled:!!t});if(!r)return null;const n=[r.first_name,r.last_name].filter(Boolean).join(" ")||r.email;return e.jsx("span",{children:n})},de=({customer:s})=>{const{t}=h(),r=k(),a=W(),{mutateAsync:n}=V(s.id),l=[s.first_name,s.last_name].filter(Boolean).join(" "),o=s.has_account?"green":"orange",m=s.has_account?t("customers.fields.registered"):t("customers.fields.guest"),p=async()=>{await r({title:t("customers.delete.title"),description:t("customers.delete.description",{email:s.email}),verificationInstruction:t("general.typeToConfirm"),verificationText:s.email,confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await n(void 0,{onSuccess:()=>{f.success(t("customers.delete.successToast",{email:s.email})),a("/customers",{replace:!0})},onError:x=>{f.error(x.message)}})};return e.jsxs(A,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(w,{children:s.email}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(me,{color:o,children:m}),e.jsx(T,{groups:[{actions:[{label:t("actions.edit"),icon:e.jsx(z,{}),to:"edit"}]},{actions:[{label:t("actions.delete"),icon:e.jsx(I,{}),onClick:p}]}]})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.name")}),e.jsx(u,{size:"small",leading:"compact",children:l||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.company")}),e.jsx(u,{size:"small",leading:"compact",children:s.company_name||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.phone")}),e.jsx(u,{size:"small",leading:"compact",children:s.phone||"-"})]})]})},v=10,b="cusgr",ue=({customer:s})=>{const t=k(),[r,a]=_.useState({}),{raw:n,searchParams:l}=q({pageSize:v,prefix:b}),{customer_groups:o,count:m,isLoading:p,isError:g,error:x}=ee({...l,fields:"+customers.id",customers:{id:s.id}},{placeholderData:G}),{mutateAsync:y}=se(s.id),j=M(),P=ge(s.id),{table:L}=N({data:o??[],columns:P,count:m,getRowId:d=>d.id,enablePagination:!0,enableRowSelection:!0,pageSize:v,prefix:b,rowSelection:{state:r,updater:a}}),F=async()=>{const d=Object.keys(r);await t({title:i("general.areYouSure"),description:i("customers.groups.removeMany",{groups:o==null?void 0:o.filter(c=>d.includes(c.id)).map(c=>c.name).join(",")}),confirmText:i("actions.remove"),cancelText:i("actions.cancel")})&&await y({remove:d},{onSuccess:()=>{f.success(i("customers.groups.removed.success",{groups:o.filter(c=>d.includes(c.id)).map(c=>c==null?void 0:c.name)}))},onError:c=>{f.error(c.message)}})};if(g)throw x;return e.jsxs(A,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(w,{level:"h2",children:i("customerGroups.domain")}),e.jsx(te,{to:`/customers/${s.id}/add-customer-groups`,children:e.jsx(re,{variant:"secondary",size:"small",children:i("general.add")})})]}),e.jsx(O,{table:L,columns:P,pageSize:v,isLoading:p,count:m,prefix:b,navigateTo:d=>`/customer-groups/${d.id}`,filters:j,search:!0,pagination:!0,orderBy:[{key:"name",label:i("fields.name")},{key:"created_at",label:i("fields.createdAt")},{key:"updated_at",label:i("fields.updatedAt")}],commands:[{action:F,label:i("actions.remove"),shortcut:"r"}],queryObject:n,noRecords:{message:i("customers.groups.list.noRecordsMessage")}})]})},pe=({group:s,customerId:t})=>{const r=k(),{t:a}=h(),{mutateAsync:n}=ne(s.id),l=async()=>{await r({title:a("general.areYouSure"),description:a("customers.groups.remove",{name:s.name}),confirmText:a("actions.remove"),cancelText:a("actions.cancel")})&&await n([t],{onError:m=>{f.error(m.message)}})};return e.jsx(T,{groups:[{actions:[{label:a("actions.edit"),icon:e.jsx(z,{}),to:`/customer-groups/${s.id}/edit`},{label:a("actions.remove"),onClick:l,icon:e.jsx(I,{})}]}]})},D=B(),ge=s=>{const t=H();return _.useMemo(()=>[D.display({id:"select",header:({table:r})=>e.jsx(E,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:a=>r.toggleAllPageRowsSelected(!!a)}),cell:({row:r})=>e.jsx(E,{checked:r.getIsSelected(),onCheckedChange:a=>r.toggleSelected(!!a),onClick:a=>{a.stopPropagation()}})}),...t,D.display({id:"actions",cell:({row:r})=>e.jsx(pe,{group:r.original,customerId:s})})],[t,s])},C="cusord",S=10,xe="*customer,*items,*sales_channel",fe="id,status,display_id,created_at,email,fulfillment_status,payment_status,total,currency_code",he=({customer:s})=>{const{t}=h(),{searchParams:r,raw:a}=Q({pageSize:S,prefix:C}),{orders:n,count:l,isLoading:o,isError:m,error:p}=ae({customer_id:s.id,fields:fe+","+xe,...r},{placeholderData:G}),g=ve(),x=$(),{table:y}=N({data:n??[],columns:g,enablePagination:!0,count:l,pageSize:S,prefix:C});if(m)throw p;return e.jsxs(A,{className:"divide-y p-0",children:[e.jsx("div",{className:"flex items-center justify-between px-6 py-4",children:e.jsx(w,{level:"h2",children:t("orders.domain")})}),e.jsx(O,{columns:g,table:y,pagination:!0,navigateTo:j=>`/orders/${j.original.id}`,filters:x,count:l,isLoading:o,pageSize:S,orderBy:[{key:"display_id",label:t("orders.fields.displayId")},{key:"created_at",label:t("fields.createdAt")},{key:"updated_at",label:t("fields.updatedAt")}],search:!0,queryObject:a,prefix:C})]})},ye=({order:s})=>{const{t}=h();return e.jsx(T,{groups:[{actions:[{label:t("transferOwnership.label"),to:`${s.id}/transfer`,icon:e.jsx(le,{})}]}]})},je=B(),ve=()=>{const s=Z({exclude:["customer"]});return _.useMemo(()=>[...s,je.display({id:"actions",cell:({row:t})=>e.jsx(ye,{order:t.original})})],[s])},xs=()=>{const{id:s}=J(),t=K(),{customer:r,isLoading:a,isError:n,error:l}=R(s,void 0,{initialData:t}),{getWidgets:o}=U();if(a||!r)return e.jsx(X,{sections:2,showJSON:!0,showMetadata:!0});if(n)throw l;return e.jsxs(ce,{widgets:{before:o("customer.details.before"),after:o("customer.details.after")},data:r,hasOutlet:!0,showJSON:!0,showMetadata:!0,children:[e.jsx(de,{customer:r}),e.jsx(he,{customer:r}),e.jsx(ue,{customer:r})]})},be=s=>({queryKey:oe.detail(s),queryFn:async()=>ie.admin.customer.retrieve(s)}),fs=async({params:s})=>{const t=s.id,r=be(t);return Y.ensureQueryData(r)};export{gs as Breadcrumb,xs as Component,fs as loader};
